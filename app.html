<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>INDIGIS â€” App (2D / 3D)</title>

  <!-- Theme / Layout -->
  <link rel="stylesheet" href="styles.css" />

  <!-- OpenLayers CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">

  <!-- Cesium CSS -->
  <link rel="stylesheet" href="https://unpkg.com/cesium/Build/Cesium/Widgets/widgets.css">

  <style>
    /* -----------------------------------------
       MAP AREA
    ------------------------------------------*/
    #olMap, #cesiumContainer {
      width: 100%;
      height: calc(100vh - var(--hud-height) - var(--status-height) - 32px);
      min-height: 420px;
    }
    #cesiumContainer { display:none; position:relative; z-index:2; }
    #olMap { display:block; position:relative; z-index:1; }

    .map-toolbar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 12px;
    }

    /* -----------------------------------------
       PREMIUM LOGO
    ------------------------------------------*/
    .app-logo-box {
      display:flex;
      align-items:center;
      gap:12px;
    }

    .app-logo {
      width:44px;
      height:44px;
      object-fit:contain;
      border-radius:12px;
      padding:4px;
      background:rgba(255,255,255,0.04);
      box-shadow:
        0 0 10px rgba(41,121,255,0.45),
        0 0 18px rgba(123,97,255,0.35);
    }

    .app-logo-text .title {
      font-size:18px;
      font-weight:700;
      letter-spacing:0.4px;
    }
    .app-logo-text .sub {
      font-size:12px;
      margin-top:2px;
      color:var(--muted);
    }

    /* -----------------------------------------
       PREMIUM HEADER GLASS EFFECT
    ------------------------------------------*/
    .top-hud {
      background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,0,0,0.18));
      backdrop-filter:blur(12px) saturate(1.4);
      border-bottom:1px solid rgba(255,255,255,0.08);
      box-shadow:0 6px 20px rgba(0,0,0,0.45);
    }

    /* -----------------------------------------
       PREMIUM TOGGLE SWITCH
    ------------------------------------------*/
    .mode-toggle {
      display:inline-flex;
      align-items:center;
      gap:10px;
      user-select:none;
      font-weight:600;
    }

    .switch {
      display:inline-grid;
      grid-template-columns:1fr 1fr;
      background:rgba(255,255,255,0.06);
      padding:4px;
      border-radius:999px;
      width:100px;
      position:relative;
      cursor:pointer;
      backdrop-filter:blur(4px);
    }

    .switch .label {
      text-align:center;
      font-size:13px;
      font-weight:600;
      z-index:2;
      color:var(--muted);
    }

    .switch .knob {
      position:absolute;
      top:4px;
      left:4px;
      height:100%;
      width:44px;
      border-radius:999px;
      background:linear-gradient(180deg, #0a84ff, #006fe6);
      box-shadow:0 6px 14px rgba(10,132,255,0.38);
      transition:transform .24s cubic-bezier(.2,.9,.3,1);
    }

    .switch.mode-3d .knob { transform:translateX(48px); }
    .switch.mode-3d .label.ThreeD { color:#fff; }
    .switch:not(.mode-3d) .label.TwoD { color:#fff; }

  </style>
</head>

<body>
<script>
  if (localStorage.getItem('indigis_logged_in') !== 'true') {
    window.location.href = 'index.html';
  }
  if (localStorage.getItem('indigis_workspace_created') !== 'true') {
    window.location.href = 'workspace.html';
  }
</script>

<div id="app" class="theme-auto">

  <!-- -----------------------------------------
       HEADER
  ------------------------------------------ -->
  <header class="top-hud">

    <div class="hud-left app-logo-box">
      <img src="assets/logo.png" class="app-logo" alt="INDIGIS Logo">
      <div class="app-logo-text">
        <span class="title">INDIGIS</span>
        <span class="sub">Prototype</span>
      </div>
    </div>

    <div class="hud-right">
      <div class="mode-toggle" title="Switch map view">
        <span style="font-size:13px;color:var(--muted)">View</span>

        <div id="mapToggle" class="switch" role="switch" aria-checked="false" tabindex="0">
          <div class="label TwoD">2D</div>
          <div class="label ThreeD">3D</div>
          <div class="knob"></div>
        </div>
      </div>

      <button id="logoutBtn" class="icon-btn" title="Logout">ðŸšª</button>
    </div>

  </header>

  <!-- -----------------------------------------
       MAIN AREA
  ------------------------------------------ -->
  <div class="main-area">

    <aside class="left-panel">
      <div class="panel">
        <div class="panel-header">Layers</div>
        <div class="panel-body">
          <ul class="layer-list">
            <li><span class="chip vector">Base Map</span></li>
            <li><span class="chip vector">Points</span></li>
            <li><span class="chip raster">Raster</span></li>
          </ul>
        </div>
      </div>
    </aside>

    <main class="map-area">
      <div class="map-toolbar">
        <div>Map View</div>
        <div id="mapInfo" style="color:var(--muted)">â€”</div>
      </div>

      <div id="olMap"></div>
      <div id="cesiumContainer"></div>
    </main>

    <aside class="right-panel">
      <div class="panel">
        <div class="panel-header">Inspector</div>
        <div class="panel-body">No selection</div>
      </div>
    </aside>

  </div>

  <!-- -----------------------------------------
       FOOTER
  ------------------------------------------ -->
  <footer class="status-ribbon">
    <div class="status-left">
      <span id="coords">Lat: â€” , Lon: â€”</span>
      <span>|</span>
      <span id="proj">Proj: WebMercator (WGS84)</span>
    </div>
    <div class="status-right">
      Scale / Height: <strong id="scale">â€”</strong>
    </div>
  </footer>

</div>

<!-- -----------------------------------------
     SCRIPTS
------------------------------------------ -->

<script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
<script src="https://unpkg.com/cesium/Build/Cesium/Cesium.js"></script>

<script>
(function () {

  const olEl = document.getElementById('olMap');
  const cesiumEl = document.getElementById('cesiumContainer');
  const coordsEl = document.getElementById('coords');
  const scaleEl = document.getElementById('scale');
  const mapInfo = document.getElementById('mapInfo');
  const toggle = document.getElementById('mapToggle');

  let is3D = false;
  let olMap, cesiumViewer;

  function initOL() {
    const fromLonLat = ol.proj.fromLonLat;
    olMap = new ol.Map({
      target: 'olMap',
      layers: [
        new ol.layer.Tile({ source: new ol.source.OSM() })
      ],
      view: new ol.View({
        center: fromLonLat([78.9629, 20.5937]),
        zoom: 3
      }),
      controls: ol.control.defaults({ attribution:false, rotate:false })
    });

    olMap.on('pointermove', evt => {
      const c = ol.proj.toLonLat(evt.coordinate);
      coordsEl.textContent = `Lat: ${c[1].toFixed(5)} , Lon: ${c[0].toFixed(5)}`;
    });

    olMap.getView().on('change:resolution', () => {
      const zoom = olMap.getView().getZoom();
      scaleEl.textContent = `zoom ${zoom.toFixed(2)}`;
      mapInfo.textContent = `Mode: 2D Â· Zoom ${zoom.toFixed(2)}`;
    });
  }

  function initCesium() {
    if (cesiumViewer) return;

    const imageryProvider = new Cesium.UrlTemplateImageryProvider({
      url: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
      credit: 'Â© OpenStreetMap contributors'
    });

    cesiumViewer = new Cesium.Viewer('cesiumContainer', {
      imageryProvider,
      selectionIndicator:false,
      timeline:false,
      animation:false,
      baseLayerPicker:false,
      geocoder:false,
      homeButton:true,
      sceneModePicker:false,
      navigationHelpButton:false,
      infoBox:false,
      fullscreenButton:false,
      shouldAnimate:true
    });

    cesiumViewer.scene.camera.setView({
      destination: Cesium.Cartesian3.fromDegrees(78.9629, 20.5937, 24000000)
    });

    setInterval(() => {
      try {
        const canvas = cesiumViewer.scene.canvas;
        const center = new Cesium.Cartesian2(canvas.clientWidth/2, canvas.clientHeight/2);
        const cart = cesiumViewer.camera.pickEllipsoid(center);

        if (cart) {
          const c = Cesium.Ellipsoid.WGS84.cartesianToCartographic(cart);
          coordsEl.textContent = `Lat: ${Cesium.Math.toDegrees(c.latitude).toFixed(5)} , Lon: ${Cesium.Math.toDegrees(c.longitude).toFixed(5)}`;
        }

        scaleEl.textContent = `${Math.round(cesiumViewer.camera.positionCartographic.height).toLocaleString()} m`;
        mapInfo.textContent = `Mode: 3D Â· Height ${Math.round(cesiumViewer.camera.positionCartographic.height).toLocaleString()} m`;

      } catch {}
    }, 300);
  }

  function show2D() {
    is3D = false;
    toggle.classList.remove('mode-3d');
    toggle.setAttribute('aria-checked','false');
    cesiumEl.style.display = 'none';
    olEl.style.display = 'block';
    olMap.updateSize();
    mapInfo.textContent = "Mode: 2D";
  }

  function show3D() {
    is3D = true;
    toggle.classList.add('mode-3d');
    toggle.setAttribute('aria-checked','true');
    olEl.style.display = 'none';
    cesiumEl.style.display = 'block';
    initCesium();
    setTimeout(() => cesiumViewer.resize(), 200);
    mapInfo.textContent = "Mode: 3D";
  }

  toggle.addEventListener('click', () => {
    is3D ? show2D() : show3D();
  });

  toggle.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggle.click();
    }
  });

  initOL();

  window.addEventListener('resize', () => {
    if (olMap) olMap.updateSize();
    if (cesiumViewer) cesiumViewer.resize();
  });

  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('indigis_logged_in');
    window.location.href = "index.html";
  });

})();
</script>

</body>
</html>
